# ch10. 상속과 코드 재사용

### 1. 상속과 중복 코드

#### DRY\(Don't Repeat Yourself\) 원칙

중복 여부를 판단하는 기준은 변경이다. 요구사항이 변경됐을 때 두 코드를 함께 수정해야 한다면 이 코드는 중복이다. 함께 수정할 필요가 없다면 중복이 아니다.

중복 여부를 결정하는 기준은 코드가 변경에 반응하는 방식이다.

DRY 원칙 : 모든 지식은 시스템 내에서 단일하고, 애매하지 않고, 정말로 믿을 만한 표현 양식을 가져야 한다.

상속으로 중복을 제거할때 자식 클래스가 부모클래스의 오버라이드 메서드를 사용할 때 결합도를 높인다. 자식 클래스가 부모클래스의 구현방법에 대한 정확한 지식을 가져야 하기 때문.

> 상속을 위한 경고 1 자식 클래스의 메서드 안에서 super 참조를 이용해 부모 클래스 메서드를 직접 호출할 경우 두 클래스는 강하게 결합된다. super 클래스 호출을 제거할 수 있는 방법을 찾아 결합도를 제거하라.

### 2. 취약한 기반 클래스 문제

부모 클래스의 변경에 의해 자식 클래스가 영향을받는 현상을 **취약한 기반 클래스 문제**라고 부른다.

상속 관계를 추가할수록 전체 시스템의 결합도가 높아진다는 사실을 알고 있어야 한다. 상속은 자식 클래스를 점진적으로 추가해서 기능을 확장하는 데는 용이하지만 높은 결합도로 인해 부모 클래스를 점진적으로 개선하는 것은 어렵게 만든다.

#### 불필요한 인터페이스 상속 문제

퍼블릭 인터페이스에 대한 고려 없이 단순히 코드 재사용을 위해 상속을 이용하는 것은 규칙을 쉽게 무시하게 하고 원칙을 꺠부순다.

> 상속을 위한 경고 2 상속은 부모 클래스의 메서드가 자식 클래스의 내부 구조에 대한 규칙을 깨트릴 수 있다.

#### 메서드 오버 라이딩의 오작용 문제

> 상속을 위한 경고 3 자식 클래스가 부모 클래스의 메서드를 오버라이딩할 경우 부모 클래스가 자신의 메서드를 사용하는 방법에 자식 클래스가 결합될 수 있다.

상속은 코드 재사용을 위해 캡슐화를 희생한다. 완벽한 캡슐화를 원한다면 코드 재사용을 포기하거나 상속 이외의 다른 방법을 사용해야 한다.

#### 부모 클래스와 자식 클래스의 동시 수정 문제

슈퍼클래스의 구현은 릴리즈를 거치면서 변경될 수 있고, 그에 따라 서브클래스의 코드를 변경하지 않더라도 깨질 수 있다.

> 상속을 위한 경고 4 클래스를 상속하면 결합도로 인해 자식 클래스와 부모 클래스의 구현을 영원히 변경하지 않거나, 자식 클래스와 부모 클래스를 동시에 변경하거나 둘 중 하나를 선택할 수 밖에 없다.

### 3. 다시 살펴보기

#### 추상화에 의존하자

자식 클래스가 부모 클래스에 강하게 결합되어 있기 때문에 부모 클래스가 변경될 떄 자식 클래스 또한 변경될 확률이 크다.

이 문제를 해결하기 위해 가장 일반적인 방법은 자식 클래스가 부모 클래스의 구현이 아닌 추상화에 의존하도록 하는 것이다. 정확하게 말하면 부모 클래스와 자식 클래스 모두 추상화에 의존하도록 수정해야 한다.

개인적으로 코드 중복을 제거하기 위해 상속을 도입할 때 따르는 두 가지 원칙이 있다.

* 두 메서드가 유사하게 보인다면 차이점을 메서드로 추출하라. 메서드 추출을 총해 두 메서드를 동일한 형태로 보이도록 만들 수 있다.
* 부모 클래스의 코드를 하위로 내리지 말고 자식 클래스의 코드를 상위로 올려라. 부모 클래스의 구체적인 메서드를 자식 클래스로 내리는 것보다 자식 클래스의 추상적인 메서드를 부모 클래스로 올리는 것이 재사용성과 응집도 측면에서 더 뛰어난 결과를 얻을 수 있다.

#### 추상화가 핵심이다.

추상 클래스를 선언하고 추상 메소드에 의존하는 것이 결합도를 낮추고 의존성 역전 원칙을 준수하며 아주 좋은 코드를 만들게 한다.

### 4. 차이에 의한 프로그래밍

상속과 같이 기존코드와 다른 부분만을 추가함으로써 애플리케이션의 기능을 확장하는 방법을 차이에 의한 프로그래밍 이라고 한다.

중복된 코드를 제거하고 코드를 재사용할 수 있는 강력한 도구는 상속이다. 하지만 재사용성을 높이기 위해 맹목적으로 상속을 사용하는 것은 위험하다. 상속의 오용과 남용은 애플리케이션을 이해하고 확장학시 어렵게 만든다. 정말로 필요한 경우에만 상속을 사용하도록 하자.

