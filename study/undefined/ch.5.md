# ch.5 책임 할당하기

### 1.책임 주도 설계를 향해

데이터 중심의 설계에서 책임 중심의 설계로 전환하기 위해서는 다음의 두 가지 원칙을 따라야 한다.

* 데이터보다 행동을 먼저 결정하라
* 협력이라는 문맥 안에서 책임을 결정하라

\
데이터보다 행동을 먼저 결정하라 객체에게 중요한 것은 데이터가 아니라 외부에 제공하는 행동들이다. 클라이언트 관점에서 객체가 수행하는 행동이란 곧 객체의 책임을 의미한다. 객체는 협력에 참여하기 위해 존재하며 협력 안에서 수행하는 책임이 객체의 존재가치를 증명한다.

데이터 중심으로 설계하면 얻게 되는 것은 변경에 취약한 설계다.

책임 중심의 설계 "이 객체가 수행해야 하는 책임은 무엇인가" 를 결정한 후에 "이 책임을 수행하는 데 필요한 데이터는 무엇인가" 를 결정하라.

\
협력이라는 문맥 안에서 책임을 결정하라 객체에게 할당된 책임의 품질은 협력에 적합한 정도로 결정된다. 객체의 입장에서는 책임이 조금 어색해 보이더라도 협력에 적합하다면 그 책임은 좋은 것이다.

> 객체를 가지고 있기 때문에 메시지를 보내는 것이 아니다. 메시지를 전송하기 때문에 객체를 갖게 된 것이다.

### 2.책임 할당을 위함 GRASP 패턴

'그레이크 라만'의 GRASP(General Responsibility Assignment Software Pattern) 패턴

설계 과정은 도메인 안에 존재하는 개념들을 정리하는 것으로 시작된다.

#### 도메인 개념에서 출발하기

설계를 시작하기 전에 도메인에 대한 개략적인 모습을 그려 보는 것이 유용하다. 도메인 안에는 무수히 많은 개념들이 존재하며 이 도메인 개념들을 책임 할당의 대상으로 사용하면 코드에 도메인의 모습을 투영하기가 좀 더 수월해진다. 이 단계에서는 책임을 할당받을 객체들의 종류와 관계에 대한 유용한 정보를 제공할 수 있다면 충분하다. 설계를 참고할 수 있는 개념들의 모음으로 간주하고 완벽을 바라지말고 도메인 개념을 정리하는 데 너무 많은 시간을 들이지 말고 빠르게 설계와 구현을 진행하라.

#### 정보 전문가에게 책임을 할당하라

메세지는 메시지를 수신할 객체가 아니라 메시지를 전송할 객체의 의도를 반영해서 결정해야 한다. 따라서 첫번째 질문은 다음과 같다.

> 메시지를 전송할 객체는 무엇을 원하는가?

협력을 시작하는 객체는 미정이지만 이 객체가 원하는 것은 분명해 보인다. 바로 영화를 예매하는 것이다. 따라서 메시지의 이름으로는 **예매하라**가 적절한 것 같다.

메시지를 결정했으므로 메시지에 적합한 객체를 선택해야 한다. 두번째 질문은 다음과 같다.

> 메시지를 수신할 적합한 객체는 누구인가?

메시지를 수신할 객체는 캡슐화가 되어 있어야 한다. 즉, 행동과 상태가 같이 있는, 자신의 상태를 스스로 처리하는 자율적인 존재여야 한다. 따라서 객체에게 책임을 할당하는 첫 번째 원칙은 책임을 수행할 정보를 알고 있는 객체에게 책임을 할당하는 것이다. 이를 **INFORMATION EXPERT(정보 전문가)** 패턴이라고 한다.

여기서 중요한점은 **정보** 는 **데이터** 와는 절대 다른 이야기이다. 책임하는 정보를 알고 있다고 해서 그 정보를 저장할 필요는 없다. 그 정보를 제공할 수 있는 다른 객체를 알거나 필요한 정보를 계산해서 제공할 수도 있다.

**INFORMATION EXPERT(정보 전문가)** 패턴에 따르면 필요한 정보를 가장 많이 알고 있는 곳에 할당하라고 했다. 아마도 '상영' 이라는 객체가 적합할 것이다. '상영'은 영화에 대한 정보와 상영 시간, 상영 순번처럼 영화 예매에 필요한 다양한 정보를 알고 있다. 따라서 영화 예매를 위한 전문가이다.

이제는 외부의 인터페이스가 아닌 내부에서 처리하기 위해 필요한 절차와 구현을 생각해야 한다. 이때 내부 인터페이스에서 전부를 처리할 필요는 없다. 외부의 다른 객체에 필요한 정보를 위해 메시지를 전송할 수도 있고 이는 곧 객체간의 협력 공동체가 구성되는 것이다.

'예매하라'의 메시지를 완료하기위해 예매 가격을 알아야 한다. 이때문에 **'가격을 계산하라'**라는 메시지가 탄생할 것이다.

영화의 가격은 당연히 **Movie** 객체가 잘 알고있을 것이다. **'가격을 계산하라'** 메시지를 Movie 에 할당하도록하자.

하지만 **'영화'** 객체는 가격을 계산하는 한계가 있다. 이유는 할인 조건을 고려하여 계산을 하지 못한다는 것이다. 고로 **Movie** 객체는 **'할인 여부를 판단하라'** 라는 메시지를 외부로 전송하여 또 협력을 구할 것이다. **'할인 여부를 판단하라'** 는 **DiscountCondition** 객체가 적합해 보이므로 여기에 할당한다. 최종적으로 **DiscountCondition** 는 스스로 내부에서 할인조건을 판단하여 제공할 수 있으므로 외부의 도움없이 수행할 수 있다.

이렇게 **INFORMATION EXPERT(정보 전문가)** 를 따르는 것만으로도 자율성이 높은 객체들로 구성된 협력 공동체를 구축할 가능성이 높아지는 것이다.

#### 높은 응집도와 낮은 결합도

그럼 위의 예시에서 **DiscountCondition**가 **Movie**와 협력하지말고 **Screening**과 직접적으로 협력하면 안되는가? 기능적으로는 별 차이가 없어보이지만, 결국 **Screening**과 **DiscountCondition**사이에 없었던 결합도가 생기게 된다. 책임을 할당할 수 있는 다양한 대안들이 존재한다면 응집도와 결합도의 측면에서 더 나은 대안을 선택하는 것이 좋다. GRASP 에서는 이를 **LOW COUPLING(낮은 결합도)**패턴과 **HIGH COHESION**패턴 이라고 부른다.

#### 창조자에게 객체 생성 책임을 할당하라.

객체 A를 생성하야 할 때 어떤 객체에게 객체 생성 책임을 할당해야 하는가?

* B가 A 객체를 포한하거나 참조한다.
* B가 A 객체를 기록한다.
* B가 A 객체를 긴밀하게 사용한다.
* B가 A 객체를 초기화하는 데 필요한 데이터를 가지고 있다.(이 경우 B는 A에 대한 정보 전문가다)

CREATOR 패턴의 의도는 어떤 방식으로든 생성되는 객체와 연결되거나 관련될 필요가 있는 객체에 해당 객체를 생성할 책임을 맡기는 것이다. **Screening**은 예메 정보를 생성하는 데 필요한 영화, 상영 시간, 상영 순번 등의 정보에 대한 전문가이며, 예매 정보를 계산하는데 필요한 **Movie** 도 알고 있다. 따라서 **Screening**은 **Reservation**를 생성하는데 필요한 생성자로 적합하다.

여기까지 설계가 맞는지 궁금한가? 코드를 작성해봐라 그럼 ㅋ.

#### 구현을 통한 검증

응집도가 높은 클래스는 인스턴스를 생성할때 모든 속성을 함께 초기화 한다. 반면 응집도가 낮은 클래스는 인스턴스를 생성할 때 일부의 속성만을 초기화한다.

클래스 응집도 판단하기 아래의 조건을 가지고있는 클래스는 응집도가 낮을 확률이 농후하다.

* 클래스가 하나 이상의 이유로 변경되야 한다면 응집도가 낮은 것이다. 변경의 이유를 기준으로 클래스를 분리하라.
* 클래스의 인스턴스를 초기화하는 시점에 경우에 따라 서로 다른 속성들을 초기화하고 있다면 응집도가 낮은 것이다. 초기화되는 속성의 그룹을 기준으로 클래스를 분리하라.
* 매서드 그룹이 속성 그룹을 사용하는지 여부로 나뉜다면 응집도가 낮은 것이다. 이들 그룹을 기준으로 클래스를 분리하라.

객체의 타입에 따라 변하는 행동이 있다면 타입을 분리하고 변화하는 행동을 각 타입의 책임으로 할당하라는것. 상위 인터페이스로 클래스를 묶어 다형성화하라. GRASP에서는 **POLYMORPHISM(다형성)** 패턴이라고 한다.

> POLYMORPHISM(다형성) 패턴 객체의 타입에 따라 변하는 로직이 있을 때 변하는 로직을 담당할 책임을 어떻게 할당해야 하는가? 타입을 명시적으로 정하고 각 타입에 다형적으로 행동하는 책임을 할당하라. if \~ else, switch 등의 조건 논리를 사용해서 설계한다면 새로운 변화가 일어날 경우 조건 논리를 수정해야한다. 이것을 프로그램을 수정하기 어렵고 변경에 취약하게 만든다.
>
> PROTECTED VARIATIONS(변경 보호) 패턴 객체, 서브시스템, 그리고 시스템을 어떻게 설계해야 변화와 불안정성이 다른 요소에 나쁜 영향을 미치지않도록 방지할 수 있을까? 변화가 예상되는 불안정한 지점들을 식별하고 그 주위에 안정된 인터페이스를 형성하도록 책임을 할당하라.
